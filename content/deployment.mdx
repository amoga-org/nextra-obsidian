# Deployment

Deploy your Nextra 4 documentation site to various hosting platforms.

## Static Export

Nextra 4 supports static export for hosting on any static hosting platform.

### Configuration

Configure static export in `next.config.mjs`:

```javascript filename="next.config.mjs"
import nextra from "nextra";

const withNextra = nextra({});

export default withNextra({
  output: "export",
  trailingSlash: true,
  images: {
    unoptimized: true,
  },
});
```

### Build Process

```bash
npm run build
```

This generates a static site in the `out/` directory.

## Vercel

Deploy to Vercel with zero configuration:

### Using Vercel CLI

```bash
npm i -g vercel
vercel
```

### Using Git Integration

1. Push your code to GitHub/GitLab/Bitbucket
2. Import your repository in Vercel
3. Deploy automatically on every push

### Build Settings

Vercel will automatically detect your Next.js project. For custom settings:

```json filename="vercel.json"
{
  "buildCommand": "npm run build",
  "outputDirectory": "out",
  "installCommand": "npm install"
}
```

## Netlify

Deploy to Netlify:

### Build Settings

```toml filename="netlify.toml"
[build]
  command = "npm run build"
  publish = "out"

[build.environment]
  NODE_VERSION = "20"
```

### Manual Deploy

```bash
npm run build
npx netlify deploy --prod --dir=out
```

## GitHub Pages

Deploy to GitHub Pages using GitHub Actions:

### Workflow Configuration

```yaml filename=".github/workflows/deploy.yml"
name: Deploy to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Build with Next.js
        run: npm run build

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: out

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
```

### Repository Settings

1. Go to Settings â†’ Pages
2. Select "GitHub Actions" as source
3. Configure custom domain (optional)

## Cloudflare Pages

Deploy to Cloudflare Pages:

### Build Configuration

- **Build command**: `npm run build`
- **Build output directory**: `out`
- **Node.js version**: `20`

### Environment Variables

```
NODE_VERSION=20
NPM_CONFIG_PRODUCTION=false
```

## Custom Server

For custom server deployment:

### Dockerfile

```dockerfile filename="Dockerfile"
FROM node:20-alpine AS base

# Install dependencies
FROM base AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

# Build the app
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# Production image
FROM nginx:alpine AS runner
COPY --from=builder /app/out /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### Docker Compose

```yaml filename="docker-compose.yml"
version: "3.8"
services:
  nextra-docs:
    build: .
    ports:
      - "3000:80"
    restart: unless-stopped
```

## Search Configuration

### Production Search Setup

Ensure search works in production:

```json filename="package.json"
{
  "scripts": {
    "build": "next build",
    "postbuild": "pagefind --site .next/server/app --output-path public/_pagefind"
  }
}
```

For static export:

```json filename="package.json"
{
  "scripts": {
    "build": "next build",
    "postbuild": "pagefind --site out --output-path out/_pagefind"
  }
}
```

## Environment Variables

### Build-time Variables

```bash filename=".env.local"
NEXT_PUBLIC_SITE_URL=https://yourdomain.com
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
```

### Production Configuration

```javascript filename="next.config.mjs"
export default withNextra({
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
  // Enable source maps in production
  productionBrowserSourceMaps: true,
});
```

## Performance Optimization

### Bundle Analysis

```bash
npm install -D @next/bundle-analyzer
```

```javascript filename="next.config.mjs"
import bundleAnalyzer from "@next/bundle-analyzer";

const withBundleAnalyzer = bundleAnalyzer({
  enabled: process.env.ANALYZE === "true",
});

export default withBundleAnalyzer(
  withNextra({
    // config
  })
);
```

Run analysis:

```bash
ANALYZE=true npm run build
```

### CDN Configuration

For static assets, configure your CDN:

```javascript filename="next.config.mjs"
export default withNextra({
  assetPrefix: "https://cdn.yourdomain.com",
  images: {
    loader: "custom",
    path: "https://cdn.yourdomain.com/",
  },
});
```

## Monitoring

### Analytics

Add analytics to your layout:

```tsx filename="app/layout.tsx"
import Script from "next/script";

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Script
          src={`https://www.googletagmanager.com/gtag/js?id=${process.env.NEXT_PUBLIC_GA_ID}`}
          strategy="afterInteractive"
        />
        <Script id="google-analytics" strategy="afterInteractive">
          {`
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '${process.env.NEXT_PUBLIC_GA_ID}');
          `}
        </Script>
      </body>
    </html>
  );
}
```

## Troubleshooting

### Common Issues

1. **Search not working**: Ensure Pagefind runs after build
2. **Images not loading**: Use `unoptimized: true` for static export
3. **TypeScript errors**: Update `moduleResolution` to `"bundler"`

### Debug Mode

Enable debug mode:

```bash
DEBUG=nextra* npm run dev
```

---

Your Nextra 4 site is now ready for production! ðŸš€
